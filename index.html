<!doctype html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Benmaamar London Search</title>

  <!-- Tailwind (CDN for simplicity) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Chart.js for insights -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <meta name="description" content="Benmaamar London Search — property scoring, ratings, and insights for a London home search." />
</head>
<body class="bg-slate-50 text-slate-900">
  <!-- Header -->
  <header class="bg-gradient-to-r from-slate-900 via-slate-800 to-slate-700 text-white shadow">
    <div class="max-w-7xl mx-auto px-5 py-4 flex items-center justify-between">
      <h1 class="text-lg md:text-xl font-semibold tracking-tight">Benmaamar London Search</h1>
      <div class="text-xs md:text-sm opacity-80" id="lastUpdated">Loading…</div>
    </div>
    <!-- Tabs -->
    <nav class="max-w-7xl mx-auto px-5 pb-3">
      <ul class="flex gap-2">
        <li><button id="tabProperties" class="tab-btn active px-3 py-2 rounded bg-white/10 hover:bg-white/20">Properties</button></li>
        <li><button id="tabInsights"   class="tab-btn px-3 py-2 rounded hover:bg-white/20">Insights</button></li>
      </ul>
    </nav>
  </header>

  <main class="max-w-7xl mx-auto p-5 space-y-6">

    <!-- ====== PROPERTIES TAB ====== -->
    <section id="panelProperties" class="space-y-6">

      <!-- Controls -->
      <section class="bg-white p-4 rounded-xl shadow-sm ring-1 ring-black/5">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div>
            <label class="block text-sm font-medium">Sort by</label>
            <select id="sortBy" class="mt-1 w-full border rounded-lg p-2">
              <option value="score">Score (desc)</option>
              <option value="price">Price (asc)</option>
              <option value="bedrooms">Bedrooms (desc)</option>
              <option value="zone">Zone (asc)</option>
              <option value="viewing_date">Viewing date (desc)</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium">Filter: min bedrooms</label>
            <input id="minBeds" type="number" min="0" value="2" class="mt-1 w-full border rounded-lg p-2" />
          </div>
          <div>
            <label class="block text-sm font-medium">Filter: tenure</label>
            <select id="tenureFilter" class="mt-1 w-full border rounded-lg p-2">
              <option value="any">Any</option>
              <option value="freehold_only">Freehold</option>
              <option value="share_or_freehold">Share of freehold or Freehold</option>
            </select>
          </div>
        </div>
        <div class="mt-4 flex flex-wrap items-center gap-3">
          <button id="refreshBtn" type="button" class="px-4 py-2 bg-slate-900 text-white rounded-lg">Refresh</button>

          <!-- Hardcoded fallback so it works even if JS fails -->
          <a id="newRatingBtn"
             href="https://github.com/Ilye5/London-Property-Search/issues/new?template=rating.yml"
             target="_blank"
             class="px-4 py-2 bg-emerald-600 text-white rounded-lg">Add / Update a Rating</a>

          <button id="editWeightsBtn" type="button" class="px-4 py-2 border rounded-lg">Edit Weights</button>
        </div>
      </section>

      <!-- Location Helper (TfL) -->
      <section class="bg-white p-4 rounded-xl shadow-sm ring-1 ring-black/5">
        <h2 class="text-lg font-semibold mb-1">Location Helper (TfL)</h2>
        <p class="text-sm text-slate-600 mb-3">
          Enter an address or postcode. We’ll geocode it, find the <b>nearest London Underground station</b> via OpenStreetMap/Overpass,
          and compute straight-line distance to Bank. (Public API — may be rate-limited.)
        </p>
        <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
          <input id="eh_addr" class="border rounded-lg p-2" placeholder="SE22 9XX or '123 Example Rd SE22'" />
          <button id="eh_go" type="button" class="px-4 py-2 bg-emerald-600 text-white rounded-lg">Check Location</button>
          <button id="eh_copy" type="button" class="px-4 py-2 border rounded-lg">Copy results</button>
          <a id="eh_issue"
             href="https://github.com/Ilye5/London-Property-Search/issues/new?template=rating.yml"
             target="_blank"
             class="px-4 py-2 bg-slate-900 text-white rounded-lg text-center">Open Rating Form</a>
        </div>
        <div id="eh_out" class="mt-3 text-sm whitespace-pre-wrap bg-slate-50 rounded-lg p-3 border"></div>
      </section>

      <!-- Table -->
      <section class="bg-white p-0 rounded-xl shadow-sm ring-1 ring-black/5 overflow-hidden">
        <div class="overflow-x-auto">
          <table class="min-w-full text-sm">
            <thead class="bg-slate-100 text-slate-700">
              <tr>
                <th class="px-4 py-3 text-left">Score</th>
                <th class="px-4 py-3 text-left">Address</th>
                <th class="px-4 py-3 text-left">Price (£)</th>
                <th class="px-4 py-3 text-left">Beds</th>
                <th class="px-4 py-3 text-left">Tenure</th>
                <th class="px-4 py-3 text-left">Zone</th>
                <th class="px-4 py-3 text-left">Travel (min)</th>
                <th class="px-4 py-3 text-left">EPC</th>
                <th class="px-4 py-3 text-left">Last Viewed</th>
                <th class="px-4 py-3 text-left">Link</th>
              </tr>
            </thead>
            <tbody id="rows"></tbody>
          </table>
        </div>
      </section>

      <!-- Weights Modal -->
      <dialog id="weightsDialog" class="rounded-xl p-0 w-full max-w-2xl">
        <form method="dialog">
          <div class="p-5 border-b">
            <h3 class="text-lg font-semibold">Edit Scoring Weights</h3>
          </div>
          <div class="p-5 space-y-3" id="weightsForm"></div>
          <div class="p-4 border-t flex justify-end gap-2">
            <button value="cancel" type="submit" class="px-4 py-2 border rounded-lg">Cancel</button>
            <button id="saveWeightsBtn" value="default" type="submit" class="px-4 py-2 bg-emerald-600 text-white rounded-lg">Save to Issue (PR)</button>
          </div>
        </form>
      </dialog>

    </section>

    <!-- ====== INSIGHTS TAB ====== -->
    <section id="panelInsights" class="hidden space-y-6">
      <section class="bg-white p-4 rounded-xl shadow-sm ring-1 ring-black/5">
        <h2 class="text-lg font-semibold mb-1">Insights</h2>
        <p class="text-sm text-slate-600 mb-4">Interactive visuals from your ratings.</p>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
          <div class="bg-slate-50 rounded-lg p-3 ring-1 ring-black/5">
            <h3 class="text-sm font-medium mb-2">Top 10 by Score</h3>
            <canvas id="chartTop10" height="220"></canvas>
          </div>
          <div class="bg-slate-50 rounded-lg p-3 ring-1 ring-black/5">
            <h3 class="text-sm font-medium mb-2">Score vs Price</h3>
            <canvas id="chartScatter" height="220"></canvas>
          </div>
          <div class="bg-slate-50 rounded-lg p-3 ring-1 ring-black/5">
            <h3 class="text-sm font-medium mb-2">Score Distribution</h3>
            <canvas id="chartHist" height="220"></canvas>
          </div>
        </div>
      </section>
    </section>

  </main>

  <footer class="max-w-7xl mx-auto p-5 text-xs text-slate-500">
    Data is committed via GitHub Issues → Action → <code>data/*.json</code>. UI auto-refreshes.
  </footer>

  <!-- App -->
  <script type="module" src="./app.js"></script>
</body>
</html>
